# External Update Rate
This directory contains files code to observe the OCC and hwmon interfaces.

The experiment itself consists of three binaries (one for hwmon, two for OCC) which read the respective interface as often as possible and store each recorded value with a timestamp.

The repository is organized around the `Makefile`.

The directory `results` is pre-populated with the data used in the paper.

Some files are compressed to save space, use `make unpack` to unpack them.

## Build
Build with `make programs`, then run the experiment binaries.

Tested against GCC 7.5.0, might build w/ lower versions too

Keep in mind that your destination is a P9 system!
(==dependencies will have to be recompiled)

## Files
- Source Code
  - `common.h`: common helpers
  - `sample_hwmon.cc`: experiment for hwmon interface
  - `sample_occ.cc`: experiment for OCC (vanilla)
  - `sample_occ_optimized.cc`: experiment for OCC (optimized)
  - `postprocess.cc`: translate produced dumpfiles
  - `slurm_submit.sh`: submit script for SLURM to run all experiments and postprocessing
  - `Makefile`: Build and run experiments
- processing scripts
  - `get_overhead_means.R`: compute mean, standard deviation across overhead per recorded sample; compute fractions per data source for occ optimized
  - `get_valuechange_means.sh`: compute mean duration how long the same value has been reported
- plotting scripts
  - `hist_readout_separation.py`: generates gnuplot script to show overhead
  - `hist_value_interval.py`: generates gnuplot script to show how long a value persists
- Raw Results ("dumps"), generated by experiment binaries (`sample_XXX`)
  - format: internal binary format, only understood by `postprocess` binary
  - `results/hwmon_dump.bin`: raw readouts from hwmon
  - `results/occ_dump.bin`: raw readouts from OCC (vanilla)
  - `results/occ_optimized_dump.bin`: raw readouts from OCC (optimized)
- Extracted results (`.dat` files in `results/` directory), generated by postprocssing (`postprocess`)
  - format: header prefixed with `#`, one data point per line (`\n`), fields separated by tabs (`\t`)
  - `results/XXX_raw.dat`: raw readouts, fields:
    - `timing_ns`: timestamp since experiment start in ns
    - `sensor`: raw sensor readout ("direct sample", for hwmon in mW, for OCC in W)
    - `acc`: raw accumulator readout (for hwmon hardcoded to 1337, for OCC copied without processing)
    - `source`: data source, for hwmon always `hwmon`, for OCC one of:
      - `ping`: only ping buffer ready, read from ping buffer
      - `pong`: only ping buffer ready, read from pong buffer
      - `both_use_ping`: both ping and pong buffers ready, read from ping buffer
      - `both_use_pong`: both ping and pong buffers ready, read from pong buffer
  - `results/XXX_sensorjitter.dat`: sensor readouts, repeating values aggregated into single row, fields:
    - `sensor_value`: sensor value (`sensor` in raw readouts)
    - `delta_value`: absolute difference to last measured value
    - `duration_ns`: how long this value has been observed in ns
    - `duration_samples`: for how many samples this value has been observed
  - `results/XXX_accjitter.dat`: accumulator readouts, repeating values aggregated into single row, fields as sensorjitter files
- aggregated results, generated by processing and plotting scripts mentioned above
  - `hist_readout_separation.gp`: histogram for overhead
  - `hist_value_interval.gp`: histogram for duration per value (how often a new value is reported)
  - `means.txt`: aggregated information
- other files
  - `README.md`: this file

## Plotting
Plot results with gnuplot using the .py files, these generate stand-alone
gnuplot scripts.
Prebuilt gnuplot scripts are included in the results.

## License
The code used in this directory is derived from [Variorum](https://github.com/llnl/variorum), which is available under the MIT license.
The following authors contributed to Variorum:
Peter Bailey, Shilpasri Bhat, Grayson Blanks, Jeff Booher-Kaeding, Stephanie Brink, Tiffany Connors, Rigoberto Delgado, Daniel Ellsworth, Aniruddha Marathe, Lauren Morita, Tapasya Patki, Barry Rountree, Kathleen Shoga, Scott Walker

